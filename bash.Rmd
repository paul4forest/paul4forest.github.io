:--
title: "Bash Commands"
output: 
  html_document: 
    toc: yes
    toc_float: true
---

```{r setup}
knitr::opts_chunk$set(eval=FALSE)
```


# Introduction
This page is the continuation of [my blog post on GNU-Linux bash shell commands](https://paulremote.blogspot.de/2014/01/linux-shell-commands.html).


Linux is the kernel of the operating system on top of which other programs are built. A detailed list of GNU core utilities is available under the command :

    info coreutils 

The page below also contains many commands from external tools 
that are not part of the GNU project.

# Files 

## Get information about a file
Determine file type and encoding. The -i option shows the mime type strings.

    file filename
    file -i filename

list a directory
```{bash}
ls
ls -R # list subdirectories recursively
ls -lh # sizes in human readable format
```

Display the [last modification date of a file](https://stackoverflow.com/questions/16391208/print-a-files-last-modified-date-in-bash)

    date -r <filename>
    ls -l <filename>
    
More file information

    stat <filename>
    
## Find files
Find files in subdirectories of the current directory (Quotes are requited to prevent shell command expansion).

    find . -name "*.pdf" 

    find . -mtime 0 # modified in the last 24 hours

Find files in the whole system

    locate filename

## File and folder compression

### Single file compression
Compress a file using gzip or 7z compression
    
    gzip <filename>
    7zr a -si<filename> <filename>.7z 

Decompress a single file from several archive formats:

    gunzip <filename.gz>
    7zr e <filename.7z>  # see also x flag below
    bzip2 -d <filename.bz2>

Convert a 7z file to gz using a pipe similar to [this answer](https://superuser.com/a/357980/419414).

    7zr e -so <filename.7z> | gzip -c > <filename.gz>

### Multiple files compression

How do I compress a whole directory?

    tar -zcvf archive-name.tar.gz directory-name 

Where

    -z: Compress archive using gzip program
    -c: Create archive
    -v: Verbose i.e display progress while creating archive
    -f: Archive File name

Decompress an archive containing multiple files
Keep full path of files within the archive
To extract content from the archive in the current directory

    tar -zxvf archive-name.tar.gz 
    7zr x <filename.7z>  

## Rename files
For example to rename all upper-case .JPG extension into lower-case .jpg extension.

    rename 's/\.JPG$/\.jpg/' *.JPG

## Move and copy files

Copy a file

    cp file1 file2

[Recursive copy some files while keeping the directory structure](https://unix.stackexchange.com/questions/83593/copy-specific-file-type-keeping-the-folder-structure)

    find . -name '*.csv' -exec cp --parents \{\} /target \;

# Search and filter text files
Search with Grep

    grep "text" file.txt

Recursive search in all files the directory for a given pattern (case insensitive)

    grep -ri "pattern" .

Search and show the line number where the string occurs

    grep -n "text" file.txt

Count occurrences of a word in a file

    grep -roh word filename.txt  | wc -w

[Awk tutorial](http://www.grymoire.com/Unix/Awk.html#uh-11), for example  filter a large file for lines that have a third field (product code) starting with 44, keep the header line:

    awk -F, '$3 ~ /^44/||NR==1' nc201501.dat|less

Regexp match begining of and end of line with ^ and \$.

Follow the end of a log file as it is written 

    tail -f

See tab and end of line characters in a text file

    cat -te filename |less 

## Count the number of lines in a text file
Count the number of lines in a file

    wc -l filename.txt 

Count the number of lines in all files, and give the total line count.

    find . -name '*.py' | xargs wc -l # python code
    find . -name '*.R' | xargs wc -l # R code

## Replace strings in text files
Replace strings

    first="I love Suzy and Mary"
    second="Sara"
    first=${first/Suzy/$second}

Replace strings with sed

    sed -i  's/pattern/replacement/g' bli.txt 

    sed -i  's/^.*\://g' input_file.txt # edit file in place
    grep EMAIL input_file.txt |sed  's/^.*\://g' > output_file.txt 

Replace strings with perl in a git repository

    git grep -lz 'readcsvfromgauss'| xargs -0 perl -i'' -pE "s/readcsvfromgauss/readcsvfromgauss0/g"

Remove duplicated lines from a file

    awk '!a[$0]++' input.txt 



## PDF files
Commands based on the poppler library for PDF manipulation.
Search a text pattern in all PDF files present in a directory:

    pdfgrep pattern *.pdf

 Merge multiple PDF into one:

    pdfunite in-1.pdf in-2.pdf in-n.pdf out.pdf

Alternatively, pdftk can be used to merge PDF files

    pdftk input1.pdf input2.pdf cat output output.pdf

[Extract pages from a pdf](https://askubuntu.com/a/282455/315347)

    pdftk full-pdf.pdf cat 12-15 output outfile_p12-15.pdf.

# Tools

## Download with Curl

Load a file from a URL, using the file name from the URL

    curl -O <url_including_a_file_name>

## Download videos and audio
Install youtube-dl using pip:

     sudo pip install --upgrade youtube_dl

Download a video from youtube :

    youtube-dl video_url

Download only the audio in an .mp3 format

    youtube-dl --extract-audio --audio-format mp3 video_url

## Play Midi files

Install a software synthethizer to play midi files.
[VideoLan Wiki](https://wiki.videolan.org/Midi/)

> If the FluidSynth codec is not shown in VLC's preferences, you have to install it as well as sound fonts. E.g. on Ubuntu 14.04 and derivatives it is in the vlc-plugin-fluidsynth package, while the fluid-soundfont-gs and fluid-soundfont-gm packages install some sound 

## Partition disks

Format a USB drive as a FAT 32 partition.

    sudo fdisk -l 
    sudo umount /dev/mmcblk0p1 
    sudo mkdosfs -F 32 -I /dev/mmcblk0

format a USB drive as a FAT 32 partition smaller than the drive size

    sudo mkdosfs -I -F 32 /dev/mmcblk0 $((2*1024*1024))

I used the GUI tool Gparted.
To see if a partition is primary, use the command:
    sudo parted /dev/mmcblk0 # then:
    print

This will print the type (primary or logical) of the partition.


# Users

## Manager users and groups
Check your user id

    id 
    echo $UID
    echo $USER

What group do you belong to as a user

    groups

Add a new user

    useradd username

Set a password for the new user

    passwd username 

Delete a user

    userdel username

Temporary log in as a given user

    su username

Add a user to the super users

    adduser username sudo

That user needs to re-log into the shell for the change to take effect.

Show all users

    getent passwd

Show all groups

    getent group 

## Change file permission


Change user and group of a file

    chown groupname:username filename

Change file permission

    chmod a=rwx filename
    chmod 777 filename 

Change file permissions recursively:

    chmod 755 directoryname

Chmod instructions can be given with characters or numbers, chmod 777 or chmod a=rwx is a question of preference.

    Some prefer 755 over 777 because giving write access to group and other users could be a security risk. 755 leaves read and execute rights to groups and other users. 755 is visible as "rwxr-xr-x" in ls -l. 
    The default for document files on Debian seems to be chmod 644, visible as "-rw-r--r--" in ls -l.

## Alias

    alias ll="ls -lh" 


Based on how can i sort du-h output by size

    alias du='du -hd1 | sort -h -r'


You can place those commands in your ~/.bashrc to create a permanent alias.
bashrc:

>    "You may want to put all your additions into a separate file like ~/.bash_aliases, instead of adding them here directly."

## Profile .bash_profile and .bashrc
These are places where a user can turn of the system BEEP :

    setterm -blength 0

.bash_profile is executed on login shell, when you login in another tty or when you access a system through ssh. .bashrc is executed on non-login shells when you open a terminal window in Gnome.

Debian Dotfiles

    "Now, since bash is being invoked as a login shell (with name "-bash", a special ancient hack), it reads /etc/profile first. Then it looks in your home directory for .bash_profile, and if it finds it, it reads that."

    [...] "You may have noted that .bashrc is not being read in this situation. You should therefore always have command source ~/.bashrc at the end of your .bash_profile in order to force it to be read by a login shell.  "

In .bashrc a user can set environment variables, define alias (see above).



# System
OS release

    less /etc/os-release 

Disk usage

    du -hd1  # sub-folder size at depth=1 
    du -hs * # sub-folder size summary

Display available space on drives

    df -h

Display available RAM memory

    less /proc/meminfo


Install a program

    sudo apt-get install 

 System name

    uname -a

    file /sbin/init

    hostname -f 

Start and quit a super user session

    su
    exit 

Last time the system was started

    last reboot 
    last

Show environment variables

    printenv 
    printenv LC_TIME

# Monitoring

Run a command every 2 seconds, 
for example to list a folder as new files are beeing written to it:

    watch ls

Follow the end of a log file, as it is written

    tail filename.log

Find out which program is listening to which port

    sudo netstat -pna | grep <port_number>

# Job handling
List

    jobs

Bring a job to the foreground

    fg job_number

Run a job in the background. A command followed by an & will run in the background.

Stop a job

    CTRL ^ Z

Move a stopped job to the background

    bg

[How to manage foreground and background processes](https://www.digitalocean.com/community/tutorials/how-to-use-bash-s-job-control-to-manage-foreground-and-background-processes) 
“By default, the bg command operates on the most recently stopped process. If you've stopped multiple “

Quit a job

     CTRL ^ C

Kill a malfunctionning program:

    kill process_id
    kill -9 process_it # -9 forces the kill

Find a program id with:

    ps aux

Kill a graphical program, by clicking on it:

     xkill


# Variables

[Variables](https://www.shellscript.sh/variables1.html)

    message = "Hello World"
    echo $message

# SSH
## Secure shell into a remote machine

log into a remote machine

    ssh user@remote_machine

Copy a local file to a file on the remote machine

    scp local_file_name user@remote_machine:path_to_file/file_name

Copy a file from the remote machine to a local file

    scp user@remote_machine:path_to_file/file_name  local_file_name

Copy a full directory (dmouraty) from the remote machine:

     scp -rp user@dest:/path destdirectory

## Generate SSH keys to access a remote git repository

Generate a new key

    cd ~/.ssh
    ssh-keygen <id_rsa_keyname>

Temporarily add a key to ssh

    ssh-add ~/.ssh/<id_rsa_keyname>

List keys

    ssh-add -l

After a restart of the ssh agent

    killall ssh-agent
    eval `ssh-agent`

This key will not be available anymore
to [permanently add a key to the ssh config file](https://stackoverflow.com/a/4246809/2641825) (SO)
Edit your `~/.ssh/config` file:
 
    IdentityFile ~/.ssh/<id_rsa_keyname>

If the key was generated with a password,and you don't exactly remember the password,
you can [test a few password you might remember with](https://stackoverflow.com/a/23666831/2641825):

    ssh-keygen -y -f <private_key_file_name>


# Locale
[Debian wiki page on Locale settings](https://wiki.debian.org/Locale)

Display locale settings

    locale

To install new locales, run :

    sudo dpkg-reconfigure locales

SSH forwards locales to the server. 
The server will try to use thegiven locale, but it might not have them installed.
[Locale variables have no effect in remote shell](https://askubuntu.com/questions/144235/locale-variables-have-no-effect-in-remote-shell-perl-warning-setting-locale-f/144448#144448)

[How do I add a locale to a Ubuntu Server?](https://askubuntu.com/questions/76013/how-do-i-add-locale-to-ubuntu-server)
Check which locales are supported:

    locale -a

add the locales you want (for example ru):

    sudo locale-gen ru_RU
    sudo locale-gen ru_RU.UTF-8

run this update comand

    sudo update-locale 


# Keyboard
bash french blogger recommended a simple shell command to change keyboard layout :

    sudo loadkeys fr

fr-keyboard on Debian wiki for a more permanent system configuration and use in GUI apps. Switching between keyboads can then be done with:

    setxkbmap de
    setxkbmap fr

Information about the system
Debian-Admin Finding out basic information about your Hardware:

    cat /proc/meminfo
    cat /proc/cpuinfo

Find your Debian version

    cat /etc/debian_version
    lsb_release -a

Shortcuts
Keyboard shortcuts for bash  for example Ctrl+A to go to the beginning of a line.
Documentation

    Creating and running bash scripts
    Unofficial Ubuntu starter guide.


